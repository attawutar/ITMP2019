<!DOCTYPE html>
<html>

<head>
    <title>Catch the Bananas</title>
    <meta charset=utf-8>
    <meta name=description content="">
    <meta name=viewport content="width=device-width, initial-scale=1">

    <style type="text/css">
        body {
            margin: 0;
            font-family: sans-serif;
            background: black;
        }

        #console {
            background: hsl(205, 58%, 59%);
            width: 100%;
            height: 5vh;
            /*padding: 10px;*/
            box-sizing: border-box;
            display: flex;
        }

        #wrap {
            background: hsl(200, 100%, 90%);
            width: 100%;
            height: 85vh;
            position: relative;
        }

        #control {
            background: hsl(300, 100%, 70%);
            width: 100%;
            height: 10vh;
            /*padding: 10px;*/
            box-sizing: border-box;
            display: flex;
        }

        #txt {
            width: 5%;
            text-align: center;
            position: relative;
            font-size: 1em;
        } 

        .butt {
            height: 100%;
            width: 20%;
            font-size: 1em;
        }

        .cmd {
            height: 100%;
            width: 50%;
            font-size: 2em;
        }

        .fruit {
            height: 20%;
            width: 20%;
            background-size: contain;
            background-position: center;
            background-repeat: no-repeat;
            position: absolute;
            top: 0%;
            left: 0%;
            transition: all .1s;
        }

        .f0 {
            background-image: url('f0.png');
        }

        .f1 {
            background-image: url('f1.png');
        }

        .f2 {
            background-image: url('f2.png');
        }

        .f3 {
            background-image: url('f3.png');
        }

        .f4 {
            background-image: url('f4.png');
        }

        #char {
            background-image: url('char.png');
            height: 20%;
            width: 20%;
            background-size: contain;
            background-position: center bottom;
            background-repeat: no-repeat;
            position: absolute;
            transition: all .1s;
        }

        [x="0"] {
            left: 0%;
        }

        [x="1"] {
            left: 20%;
        }

        [x="2"] {
            left: 40%;
        }

        [x="3"] {
            left: 60%;
        }

        [x="4"] {
            left: 80%;
        }

        [y="-1"] {
            top: -20%;
        }

        [y="0"] {
            top: 0%;
        }

        [y="1"] {
            top: 20%;
        }

        [y="2"] {
            top: 40%;
        }

        [y="3"] {
            top: 60%;
        }

        [y="4"] {
            top: 80%;
        }
    </style>
</head>

<body>
    <div id="console">
        <button class="butt" onclick="gameStart()">Start</button>
        <button class="butt" onclick="gameStop()">Stop</button>
        <button class="butt" onclick="gameRe()">Restart</button>
        <input type="text" id="txt">
    </div>
    <div id="wrap">
        <div id="char" x="0" y="4"></div>
    </div>
    <div id="control">
        <button class="cmd" onclick="moveChar(-1)">
            <</button>
                <button class="cmd" onclick="moveChar(+1)">></button>
    </div>


    <script>
        nowID = 0;

        function gameStart() {
            letplay = setInterval(function () {
                newFruit();
            }, 1000)
            skyfall = setInterval(function () {
                fallingSlowly();
            }, 1000)
            startCount()
        }

        var c = 30;
        var t;
        var timer_is_on = 0;
        var heart = 3;
        

        function timedCount() {
            document.getElementById("txt").value = c;
            c = c - 1;
            t = setTimeout(timedCount, 1000);
            if(c <= -1){
                gameStop();
            }
        }

        function startCount() {
            if (!timer_is_on) {
                timer_is_on = 1;
                timedCount();
            }
        }

        function stopCount() {
            clearTimeout(t);
            timer_is_on = 0;
        }


        function newFruit() {
            let f = document.createElement("div");
            f.setAttribute("x", rand(5));
            f.setAttribute("y", -1);
            f.setAttribute("class", "fruit f" + rand(2));
            f.setAttribute("id", "fruit_" + nowID);
            wrap.appendChild(f);
            nowID++;
        }
        function fallingSlowly() {
            let f = document.querySelectorAll(".fruit");
            for (var i = 0; i < f.length; i++) {
                let fruitY = f[i].getAttribute("y");
                let fruitX = f[i].getAttribute("x");
                fruitY = parseInt(fruitY);
                fruitX = parseInt(fruitX);
                f[i].setAttribute("y", fruitY + 1);
                if (fruitY == 4) {
                    //แก้เพิ่มตรงนี้
                    f[i].outerHTML = "";
                }
                if (fruitY == 4 & fruitX == nowX) {
                    heart - 1
                }
                if(heart <= -1){
                    gameStop()
                }
            }
        }
        function moveChar(step) {
            let nowX = char.getAttribute("x");
            nowX = parseInt(nowX);
            if (step == 1 && nowX == 4) {
                step = 0
            }
            if (step == -1 && nowX == 0) {
                step = 0
            }
            char.setAttribute("x", nowX + step);
        }
        function rand(max) {
            return Math.floor(Math.random() * Math.floor(max));
        }
        function gameStop() {
            clearInterval(letplay);
            clearInterval(skyfall);
            stopCount()
        }

        function gameRe() {
            location.reload();
        }
    </script>
</body>

</html>